# 微服务

## 几个重要特点

* 为服务粒度
* 独立进程
* 围绕业务建模
* 轻量级通信
* 去中心化管理

## 轻量级通信

* ResultFul——Http通信

* HAL也是基于ResultFul协议做了提升

* RPC: Thrift、gRpc、dubbol等

* 消息队列（可以把同步消息变为异步消息）

## 服务注册／发现

* 为服务注册中心：ZK、Consul等
    * Host
    * Port
    * Config等
* 为服务发现
    * 下游发现
    * 负载均衡 
        * Keepalive
        * Retry

## 柔性可用

* 可能出现的问题：
    * 流量高峰期短时请求较大
    * 服务能力有限
    * 性能下降
    * 服务宕机
    * 系统雪崩

* 解决方案

目标：保证核心服务可用；非核心服务弱可用，甚至不可用

* 系统降级
    * 拒绝部分请求
        * 拒绝部分老请求
            * 减轻为服务请求处理数量
            * 确保“新”请求正常响应
            * RPC队列方式（请求入队、出队时间处理请求时，检查请求在队列请求时间超过一定时间比如1S，直接丢弃）
        * 优先级请求方式
            * 非核心业务直接丢弃（业务紧急）
        * 随机拒绝方式
            * 随机丢弃一部分请求
            * 网站一会可用，一会不可用
    * 关闭部分请求
* 数据层降级
    * 更新请求
        * 持久到消息队列
        * 只更新到缓存
    * 读请求
        * 从缓存读
    * 消息补齐
        * 消息队列——>数据库
* 柔性可用策略
    * 自动开启，不要依赖人力